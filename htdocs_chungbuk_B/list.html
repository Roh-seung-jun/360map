<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="bootstrap-4.3.1-dist/css/bootstrap.css">
    <script src="jquery-3.6.0.js"></script>
    <script src="jquery-ui-1.12.1.custom/jquery-ui.js"></script>
    <script src="bootstrap-4.3.1-dist/js/bootstrap.js"></script>
    <style>
        .data-push,tr{height: 50px !important;}
    </style>
    <script>
        $(()=>{
            if(!localStorage.pay)localStorage.pay = [];
            let arr = getData();
            let table = '';
            arr.forEach((e,idx)=>{
                table += `
                <tr>
                    <td>${e.number}</td>
                    <td>${e.writer}</td>
                    <td>${e.name}</td>
                    <td>${e.join}</td>
                    <td><button class="btn btn-outline-primary" onclick="download(${idx})" >투자계약서</button></td>
                </tr>
            `;
            })
            $('table .data-push').html(table);

        })
        function getData(){
            let arr = [];
            if(localStorage.pay)
                arr = JSON.parse(localStorage.pay);
            return arr.reverse();
        }


        //값 입력
        async function drawCanvas(){
        }

        //이미지 로드
        async function imgLoad(url){
            return new  Promise(resolve => {
                const image = new Image();
                image.addEventListener('load', () => {
                    resolve(image);
                });
                image.src = url;
            });
        }

        async function download(idx){
            let invest = getData()[idx];
            let canvas = $('<canvas id="canvas" width="793" height="495"></canvas>')[0];
            let ctx = canvas.getContext('2d');
            canvas.width = 452;
            canvas.height = 300;
            let img = await imgLoad('/2과제/투자계약서.png');
            let sign = await imgLoad(invest.image);
            ctx.drawImage(img,0,0,canvas.width,canvas.height);
            ctx.fillText(invest.number,150,90)
            ctx.fillText(invest.writer,150,130)
            ctx.fillText(invest.name,150,180)
            ctx.fillText(invest.join,150,220)
            ctx.drawImage(sign,200,220,350,50);
            console.log(sign);
            let data = canvas.toDataURL('image/png');
            let tag = document.createElement('a');
            tag.download = '투자계약서.png';
            tag.href = data;
            tag.click();
        }
    </script>
</head>
<body style="height: 100vh">
<div class="d-flex justify-content-center w-100">
    <table class="table w-50" style="margin-top: 200px">
        <thead class="thead-light">
        <tr>
            <td>투자번호</td>
            <td>청년작가 이름</td>
            <td>투자자명</td>
            <td>투자금액</td>
            <td>투자계약서</td>
        </tr>
        </thead>
        <tbody class="data-push">
        </tbody>
    </table>
</div>
</body>
</html>